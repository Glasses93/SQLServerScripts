
--DROP TABLE IF EXISTS #T1;

SET XACT_ABORT ON;

BEGIN TRY
	BEGIN TRANSACTION;

		SELECT a = ISNULL(1, 1) INTO #T1;

		ALTER TABLE #T1 ADD CONSTRAINT PK PRIMARY KEY CLUSTERED (a ASC);

		INSERT #T1 SELECT 1;

	COMMIT TRANSACTION;
END TRY
BEGIN CATCH
	SELECT HEY = @@TRANCOUNT;
	IF @@TRANCOUNT > 0 ROLLBACK;
END CATCH
;






--ROLLBACK TRANSACTION;

SELECT *
FROM #T1
;

SELECT @@TRANCOUNT;
