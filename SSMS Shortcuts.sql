EXEC sys.sp_executesql N'DECLARE @SQL nvarchar(max) = SPACE(0); SELECT @SQL += N''UNION ALL SELECT [Server] = @@SERVERNAME COLLATE SQL_Latin1_General_CP1_CI_AS ,[Database] = N'''''' + [name] + N'''''' COLLATE SQL_Latin1_General_CP1_CI_AS ,[Schema] = s.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,[Table] = t.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,[# of Rows] = FORMAT(SUM(p.[rows]), ''''N0'''') FROM '' + QUOTENAME([name]) + N''.sys.schemas s INNER JOIN '' + QUOTENAME([name]) + N''.sys.tables t ON s.[schema_id] = t.[schema_id] INNER JOIN '' + QUOTENAME([name]) + N''.sys.partitions p ON t.[object_id] = p.[object_id] WHERE p.[index_id] IN (0, 1) AND t.[name] = @tbl GROUP BY t.[name] ,s.[name] '' FROM sys.databases WHERE [database_id] > 4 AND HAS_DBACCESS([name]) = 1 AND [state] = 0; SELECT @SQL = STUFF(@SQL, 1, 9, N'''') + N''ORDER BY [Database], [Schema];''; EXEC sys.sp_executesql @SQL, N''@tbl sysname'', @tbl;', N'@tbl sysname', 

EXEC sys.sp_executesql N';WITH x AS ( SELECT srv = @@SERVERNAME, db = DB_NAME(), sch = s.[name], tbl = t.[name], obj_id = t.[object_id], idx = i.[name], idx_type = LOWER(i.[type_desc]), idx_id = i.[index_id], idx_keys = CASE WHEN ic.[key_ordinal] = 1 THEN CONVERT(nvarchar(max), QUOTENAME(c.[name])) + CASE WHEN i.[type_desc] IN (N''CLUSTERED'', N''NONCLUSTERED'') THEN CASE ic.[is_descending_key] WHEN 1 THEN N'' DESC'' ELSE N'' ASC'' END ELSE N'''' END ELSE N'''' END, [incld_col(s)] = CASE ic.[is_included_column] WHEN 1 THEN CONVERT(nvarchar(max), QUOTENAME(c.[name])) ELSE N'''' END, idx_col_id = ic.[index_column_id], filter_def = COALESCE(i.[filter_definition], N''no filter applied''), i.[is_primary_key], i.[is_unique], i.[ignore_dup_key], i.[fill_factor], i.[is_disabled], col_no = 1 FROM sys.schemas s INNER JOIN sys.tables t ON s.[schema_id] = t.[schema_id] INNER JOIN sys.indexes i ON t.[object_id] = i.[object_id] INNER JOIN sys.index_columns ic ON i.[object_id] = ic.[object_id] AND i.[index_id] = ic.[index_id] INNER JOIN sys.columns c ON ic.[object_id] = c.[object_id] AND ic.column_id = c.[column_id] WHERE t.[name] = @tbl AND 1 IN (ic.[key_ordinal], ic.[index_column_id]) UNION ALL SELECT srv = x.srv, db = x.db, x.sch, x.tbl, x.obj_id, x.idx, x.idx_type, x.idx_id, idx_keys = CASE WHEN ic.[key_ordinal] = x.col_no + 1 THEN x.idx_keys + N'', '' + QUOTENAME(c.[name]) + CASE WHEN i.[type_desc] IN (N''CLUSTERED'', N''NONCLUSTERED'') THEN CASE ic.[is_descending_key] WHEN 1 THEN N'' DESC'' ELSE N'' ASC'' END ELSE N'''' END ELSE x.idx_keys END, [incld_col(s)] = CASE WHEN ic.[is_included_column] = 1 AND x.[incld_col(s)] != N'''' THEN x.[incld_col(s)] + N'', '' + QUOTENAME(c.[name]) WHEN ic.[is_included_column] = 1 AND x.[incld_col(s)] = N'''' THEN QUOTENAME(c.[name]) ELSE N'''' END, idx_col_id = ic.[index_column_id], x.filter_def, x.[is_primary_key], x.[is_unique], x.[ignore_dup_key], x.[fill_factor], x.[is_disabled], col_no = x.col_no + 1 FROM sys.schemas s INNER JOIN sys.tables t ON s.[schema_id] = t.[schema_id] INNER JOIN sys.indexes i ON t.[object_id] = i.[object_id] INNER JOIN sys.index_columns ic ON i.[object_id] = ic.[object_id] AND i.[index_id] = ic.[index_id] INNER JOIN sys.columns c ON ic.[object_id] = c.[object_id] AND ic.[column_id] = c.[column_id] INNER JOIN x ON i.[object_id] = x.[obj_id] AND i.[index_id] = x.idx_id AND x.col_no + 1 IN (ic.[key_ordinal], ic.[index_column_id])),y AS ( SELECT *, rn = ROW_NUMBER() OVER (PARTITION BY sch, idx_id ORDER BY col_no DESC), [compression] = CASE WHEN EXISTS ( SELECT 1 FROM sys.partitions p WHERE x.obj_id = p.[object_id] AND x.idx_id = p.[index_id] AND p.[data_compression_desc] = N''PAGE'' ) THEN ''page'' WHEN EXISTS ( SELECT 1 FROM sys.partitions p WHERE x.obj_id = p.[object_id] AND x.idx_id = p.[index_id] AND p.[data_compression_desc] = N''ROW'' ) THEN ''row'' WHEN EXISTS ( SELECT 1 FROM sys.partitions p WHERE x.obj_id = p.[object_id] AND x.idx_id = p.[index_id] AND p.[data_compression_desc] = N''NONE'' ) THEN ''none'' END FROM x) SELECT srv, db, sch, tbl, idx, idx_type, idx_keys, [incld_col(s)], filter_def, [is_primary_key], [is_unique], [ignore_dup_key], [fill_factor], [is_disabled], [compression] FROM y WHERE rn = 1 ORDER BY sch ASC, idx_id ASC;',N'@tbl sysname', 

EXEC sys.sp_executesql N'DECLARE @SQL nvarchar(max) = SPACE(0); SELECT @SQL += N''UNION ALL SELECT srv = @@SERVERNAME COLLATE SQL_Latin1_General_CP1_CI_AS ,db = N'''''' + [name] + N'''''' COLLATE SQL_Latin1_General_CP1_CI_AS ,sch = s.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,obj = o.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,obj_type = CASE o.[type] WHEN ''''U'''' THEN ''''Table'''' WHEN ''''V'''' THEN ''''View'''' END COLLATE SQL_Latin1_General_CP1_CI_AS ,col = c.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,col_pos = c.[column_id] ,datatype = t.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,c.[max_length] ,c.[precision] ,c.[scale] ,c.[is_nullable] ,c.[is_identity] ,c.[collation_name] COLLATE SQL_Latin1_General_CP1_CI_AS FROM '' + QUOTENAME([name]) + N''.sys.schemas s INNER JOIN '' + QUOTENAME([name]) + N''.sys.objects o ON s.[schema_id] = o.[schema_id] INNER JOIN '' + QUOTENAME([name]) + N''.sys.columns c ON o.[object_id] = c.[object_id] INNER JOIN '' + QUOTENAME([name]) + N''.sys.types t ON c.[user_type_id] = t.[user_type_id] WHERE o.[type] IN (''''U'''', ''''V'''') AND o.[name] = @ObjName '' FROM sys.databases WHERE [database_id] > 4 AND [state] = 0 AND HAS_DBACCESS([name]) = 1; SELECT @SQL = STUFF(@SQL, 1, 9, N'''') + N'' ORDER BY db, sch, obj, col_pos;''; EXEC sys.sp_executesql @SQL, N''@ObjName sysname'', @ObjName;',N'@ObjName sysname', 

EXEC sys.sp_executesql N'DECLARE @SQL nvarchar(max) = SPACE(0); SELECT @SearchString = REPLACE( REPLACE( REPLACE( @SearchString, N''['' , N''[[]'' ) , N''%'' , N''[%]'' ) , N''_'' , N''[_]'' ); SELECT @SQL +=N''UNION ALL SELECT ca.* ,srv_db_sch_obj = QUOTENAME(ca.srv) + N''''.'''' + QUOTENAME(ca.db) + N''''.'''' + QUOTENAME(ca.sch) + N''''.'''' + QUOTENAME(ca.obj) ,obj_type = CASE o.[type] WHEN ''''U'''' THEN ''''Table'''' WHEN ''''V'''' THEN ''''View'''' END ,col = c.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,col_pos = c.[column_id] FROM '' + QUOTENAME([name]) + N''.sys.schemas s INNER JOIN '' + QUOTENAME([name]) + N''.sys.objects o ON s.[schema_id] = o.[schema_id] INNER JOIN '' + QUOTENAME([name]) + N''.sys.columns c ON o.[object_id] = c.[object_id] CROSS APPLY ( SELECT srv = @@SERVERNAME COLLATE SQL_Latin1_General_CP1_CI_AS ,db = N'''''' + [name] + N'''''' COLLATE SQL_Latin1_General_CP1_CI_AS ,sch = s.[name] COLLATE SQL_Latin1_General_CP1_CI_AS ,obj = o.[name] COLLATE SQL_Latin1_General_CP1_CI_AS) ca WHERE o.[type] IN (''''U'''', ''''V'''') AND ( c.[name] LIKE N''''%'''' + @SearchString + N''''%'''' OR o.[name] LIKE N''''%'''' + @SearchString + N''''%'''' ) '' FROM sys.databases WHERE [database_id] > 4 AND [state] = 0 AND HAS_DBACCESS([name]) = 1; SELECT @SQL = STUFF(@SQL, 1, 9, N'''') + N''ORDER BY col, db, sch, obj;''; EXEC sys.sp_executesql @SQL, N''@SearchString sysname'', @SearchString;', N'@SearchString sysname', 